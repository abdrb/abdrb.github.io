<!DOCTYPE html>
<html>
 <head>
 <meta name="viewport" content="width=device-width, initial-scale=1">

 <link rel="stylesheet" type="text/css" href="../css/menu.css">
 <link rel="stylesheet" type="text/css" media="screen and (max-width: 767px)" href="../css/smallscreen.css">
 <link rel="stylesheet" type="text/css" media="screen and (min-width: 768px)" href="../css/widescreen.css">
 
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
 
 <title>حاسبة منظومة الطاقة الشمسية</title>
 <style type="text/css">
body{
margin: 0px 20px 0px 0p;
}
h3 {
color: darkcyan;
margin: 5px;
text-align: right;
}

.dv {
font-size: 12px;
text-align: right;
direction: rtl;
}

section{
direction: rtl;
text-align: right;
padding: 20px;
}

.dv input {
height; 20px;
margin: 5px;
}

navbar{
text-align: left;
direction: ltr;
}
 </style>
 </head> 
 <body onload="funclinks();"> 
<navbar>
   <input class="menu-btn" type="checkbox" id="menu-btn" />
   <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label>
   <ul class="menu" id="links">
   </ul>
</navbar>
 
<header>
 <h3>حاسبة منظومة الطاقة الشمسية</h3>
</header>
  <section>
  <div class="dv"> 
   <div>
     اللوح الشمسي (وات) 
   </div> 
   <input value="0" type="text" id="panel" onkeyup="funcPanel()" onclick="javascript:panel.value=''"> 
   <br> 
   <div>
    قوة الشاحن (أمبير) 
   </div> 
   <input value="0" type="text" id="charge" onkeyup="funcCharge()" onclick="javascript:charge.value=''"> 
   <br> 
   <div>
     مدة الشحن (ساعات) 
   </div> 
   <input value="8" type="text" id="daytime" onkeyup="funcDaytime()" onclick="javascript:daytime.value=''"> 
   <br> 
   <div>
  الاستهلاك المناسب في الساعة (أمبير) 
   </div> 
   <input value="0" type="text" id="perhour" onkeyup="funcPerhour()" onclick="javascript:perhour.value=''"> 
   <br> 
   <div>
     قوة البطارية (أمبير) 
   </div> 
   <input value="0" type="text" id="battery" onkeyup="funcBattery()" onclick="javascript:battery.value=''"> 
   <br> 
  </div> 
  </section>
<footer>
  <div id="sociallinks">
  </div>
</footer>

<script type="text/javascript">

// ثوابت النظام
const systemVoltage = 12;
const efficiency = 0.8;

// ============ حساب عند إدخال قدرة اللوح ============
function funcPanel() {
    const panelVal = Number(panel.value);
    const sunHours = Number(daytime.value);
    const loadA = Number(perhour.value);

    // حساب طاقة اللوح خلال ساعات الشمس
    const panelWh = panelVal * sunHours;

    // حساب استهلاك الأحمال أثناء الشحن
    const loadWh = loadA * systemVoltage * sunHours;

    // الطاقة المتبقية للبطارية
    const availableWh = panelWh - loadWh;

    if (availableWh > 0) {
        const batteryAh = (availableWh * efficiency) / systemVoltage;
        const chargeVal = panelVal / systemVoltage;

        charge.value = chargeVal.toFixed(1);
        battery.value = batteryAh.toFixed(1);
    }
}

// ============ حساب عند إدخال أمبير الشاحن ============
function funcCharge() {
    const chargeA = Number(charge.value);
    const sunHours = Number(daytime.value);
    const loadA = Number(perhour.value);

    const panelVal = chargeA * systemVoltage;
    const panelWh = panelVal * sunHours;
    const loadWh = loadA * systemVoltage * sunHours;
    const availableWh = panelWh - loadWh;

    if (availableWh > 0) {
        const batteryAh = (availableWh * efficiency) / systemVoltage;

        panel.value = panelVal.toFixed(1);
        battery.value = batteryAh.toFixed(1);
    }
}

// ============ حساب عند تغيير ساعات الشمس ============
function funcDaytime() {
    const panelVal = Number(panel.value);
    const chargeA = Number(charge.value);
    const sunHours = Number(daytime.value);
    const loadA = Number(perhour.value);

    if (panelVal > 0) {
        const panelWh = panelVal * sunHours;
        const loadWh = loadA * systemVoltage * sunHours;
        const availableWh = panelWh - loadWh;

        if (availableWh > 0) {
            const batteryAh = (availableWh * efficiency) / systemVoltage;
            battery.value = batteryAh.toFixed(1);
        }
    }

    if (chargeA > 0) {
        panel.value = (chargeA * systemVoltage).toFixed(1);
    }
}

// ============ حساب عند إدخال الاستهلاك في الساعة ============
function funcPerhour() {
    const loadA = Number(perhour.value);
    const panelVal = Number(panel.value);
    const sunHours = Number(daytime.value);

    if (panelVal > 0) {
        const panelWh = panelVal * sunHours;
        const loadWh = loadA * systemVoltage * sunHours;
        const availableWh = panelWh - loadWh;

        if (availableWh > 0) {
            battery.value = ((availableWh * efficiency) / systemVoltage).toFixed(1);
        }
    }
}

// ============ حساب عند إدخال سعة البطارية ============
function funcBattery() {
    const batteryAh = Number(battery.value);
    const sunHours = Number(daytime.value);
    const loadA = Number(perhour.value);

    // الطاقة المطلوبة لشحن البطارية بالكامل
    const batteryWh = batteryAh * systemVoltage;
    const requiredWh = batteryWh / efficiency;

    // الطاقة المستهلكة أثناء الشحن
    const loadWh = loadA * systemVoltage * sunHours;

    // إجمالي الطاقة المطلوبة من الألواح
    const totalNeededWh = requiredWh + loadWh;

    // قدرة اللوح المطلوبة
    const panelVal = totalNeededWh / sunHours;

    const chargeVal = panelVal / systemVoltage;

    panel.value = panelVal.toFixed(1);
    charge.value = chargeVal.toFixed(1);
}

// ============ دوال التقريب (كما هي) ============
function toUnder(n) {
    const rounded = Math.round(n);
    const remainder = rounded % 10;
    return remainder < 5 ? (rounded - remainder).toFixed(0) : (rounded - remainder + 10).toFixed(0);
}

function toUp(n) {
    const rounded = Math.round(n);
    const remainder = rounded % 10;
    return (rounded - remainder + 10).toFixed(0);
}

</script>
 
  <script src="../js/links.js" type="text/javascript"></script>
 </body>
</html>
